\usepackage[margin=1in]{geometry}
\usepackage{enumitem}
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{makecell}
\usepackage{diagbox}
\usepackage{physics}
\usepackage{actuarialsymbol}
\usepackage{fontawesome5}
\usepackage[svgnames]{xcolor}
\usepackage{datetime2}
\usepackage{amsthm}
\usepackage{soul}
\usepackage{pgfplots}
\usepackage{booktabs}
\usepackage[type={CC},modifier={by},version={4.0}]{doclicense}
\usepackage{imakeidx}
\usepackage[style=apa]{biblatex}
\usepackage{xfp}
\usepackage{tikz}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\usepackage{todonotes}
\usepackage{centernot}
\usepackage{cleveref}

\usetikzlibrary{arrows.meta}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{decorations.shapes}
\usetikzlibrary{calligraphy}
\usetikzlibrary{shapes}
\usetikzlibrary{patterns}
\usetikzlibrary{patterns.meta}
\usetikzlibrary{positioning}
\usetikzlibrary{external}
\usetikzlibrary{tikzmark}
\usepgfplotslibrary{fillbetween}

\newcommand*{\defn}[1]{\index[def]{#1}\textcolor{ForestGreen}{\textbf{#1}}}
\newcommand*{\bu}[1]{\textbf{\underline{#1}}}
\newcommand*{\eqd}{\overset{d}=}
\newcommand*{\apxsim}{\overset{\text{approx.}}\sim}
\newcommand*{\ystar}{\textcolor{yellow}{\faIcon{star}}}
\newcommand*{\indicset}[1]{\mathbf{1}_{\left\{#1\right\}}}
\newcommand*{\vari}[1]{\operatorname{Var}\qty(#1)}
\newcommand*{\cov}[1]{\operatorname{Cov}\qty(#1)}
\newcommand*{\iid}{\overset{\text{iid}}{\sim}}
\newcommand*{\vect}[1]{\vb*{#1}}
\newcommand*{\convp}{\overset{p}{\to}}
\newcommand*{\convd}{\overset{d}{\to}}
\newcommand*{\convas}{\overset{\text{a.s.}}{\to}}
\newcommand*{\convms}{\overset{\text{m.s.}}{\to}}
\newcommand*{\lik}[2]{\ell_{#1}\qty(#2)}
\newcommand*{\N}{\mathbb{N}}
\newcommand*{\Z}{\mathbb{Z}}
\newcommand*{\Q}{\mathbb{Q}}
\newcommand*{\C}{\mathbb{C}}
\newcommand*{\R}{\mathbb{R}}
\newcommand*{\E}{\mathbb{E}}
\newcommand*{\F}{\mathbb{F}}
\newcommand*{\warn}{\textcolor{red}{\faIcon{exclamation-triangle}}}
\newcommand*{\prob}[1]{\mathbb{P}\qty(#1)}
\newcommand*{\expv}[1]{\mathbb{E}\qty[#1]}
\newcommand*{\probtheta}[1]{\mathbb{P}_{\theta}\qty(#1)}
\newcommand*{\expvtheta}[1]{\mathbb{E}_{\theta}\qty[#1]}

\newenvironment{remark}{\sffamily \underline{Remarks}:\begin{itemize}}{\end{itemize}}
\newenvironment{note}{\sffamily\lbrack Note:}{\!\!\rbrack}
\newenvironment{mnemonic}{\sffamily\lbrack Mnemonic {\color{pink!90!black}\faIcon{brain}}:}{\!\!\rbrack}
\newenvironment{warning}{\sffamily\lbrack \warn\;\textcolor{red}{Warning}:}{\!\!\rbrack}
\newenvironment{intuition}{\sffamily\lbrack Intuition \textcolor{yellow!80!black}{\faIcon{lightbulb}}:}{\!\!\rbrack}
\newenvironment{pf}{\sffamily\underline{Proof}:}{\qed}

\theoremstyle{definition}
\newtheorem{proposition}{Proposition}[subsection]
\renewcommand*\theproposition{\thesubsection.\alph{proposition}}
\newtheorem{corollary}[proposition]{Corollary}
\newtheorem{theorem}[proposition]{Theorem}
\newtheorem{lemma}[proposition]{Lemma}
\newtheorem{axiom}[proposition]{Axiom}

\addbibresource{bib/references.bib}
\urlstyle{tt}
\pgfplotsset{compat=1.18}
\makeindex[name=def, title=Concepts and Terminologies]
\tikzexternalize[prefix=figures/]
\setenumerate[1]{label=\thesubsection.\arabic*~, ref=[\thesubsection.\arabic*]}

%For links in index page to link to line
%https://tex.stackexchange.com/questions/405813/link-to-line-instead-of-page
\makeatletter
\AtBeginDocument{
  \LetLtxMacro\egregs@index\index
  \RenewDocumentCommand{\index}{o+m}{%
    \begingroup
    \phantomsection%
    \IfValueTF{#1}{%
      \imki@wrindexentry{#1}{#2|hyperlink{\@currentHref}}{\thepage}%
    }{%
      \imki@wrindexentry{\jobname}{#2|hyperlink{\@currentHref}}{\thepage}%
    }%
    \endgroup
  }
}
%avoid tikzexternalize for todonotes
\renewcommand{\todo}[2][]{\tikzexternaldisable\@todo[#1]{#2}\tikzexternalenable}
\renewcommand{\missingfigure}[2][]{\tikzexternaldisable\@missingfigure[#1]{#2}\tikzexternalenable}
\makeatother
